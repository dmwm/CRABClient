#!/bin/bash

# CRAB wrapper script.

# CMSSW and COMP repositories are built with different .. everything, so this
#     script handles transparently converting client commands to the right
#     repo. We will change /cvmfs/cms.cern.ch/crab3/crab.sh to set a magic
#     environment $CMS_CRAB_ENV_SCRIPT. If found, this script will do the env
#     magic.
if [ "x$CMS_CRAB_ENV_SCRIPT" == "x" ]; then
    # Fallback to the old behavior
    exec python -m CRABClient.CRABCommandLine"$@"
else
    # 1) Save the old SCRAM location
    # 2) Call scram unsetenv
    # 3) Call the real CRAB binary


    # 1) CMSSW_BASE should have the location to run 'scram project' later to regain
    #    the SCRAM environment
    MY_CMSSW_BASE=$CMSSW_BASE

    # 2) Unset the SCRAM environment
    eval `scramv1 unsetenv -sh`

    # 3) Call the real CRAB binary
    source $CMS_CRAB_ENV_SCRIPT
    export CMSSW_BASE=$MY_CMSSW_BASE
    exec python -m CRABClient.CRABCommandLine "$@"
fi
